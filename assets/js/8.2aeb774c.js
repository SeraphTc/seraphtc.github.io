(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{56:function(t,a,e){"use strict";e.r(a);var r=e(0),i=Object(r.a)({},function(){this.$createElement;this._self._c;return this._m(0)},[function(){var t=this,a=t.$createElement,e=t._self._c||a;return e("div",{staticClass:"content"},[e("h1",{attrs:{id:"声讯平台v1-1改造梳理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#声讯平台v1-1改造梳理","aria-hidden":"true"}},[t._v("#")]),t._v(" 声讯平台V1.1改造梳理")]),e("h2",{attrs:{id:"一、1-0梳理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、1-0梳理","aria-hidden":"true"}},[t._v("#")]),t._v(" 一、1.0梳理")]),e("h3",{attrs:{id:"_1-0链条结构"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-0链条结构","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.0链条结构:")]),e("img",{attrs:{src:"img1/d3-1.png"}}),e("h3",{attrs:{id:"_1-0流程："}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-0流程：","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.0流程：")]),e("img",{attrs:{src:"img1/d3-2.png"}}),e("p"),e("h3",{attrs:{id:"_1-0er图"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-0er图","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.0ER图:")]),e("img",{attrs:{src:"img1/d3-3.png"}}),e("h3",{attrs:{id:"_1-0遗留的问题"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-0遗留的问题","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.0遗留的问题")]),e("p",[t._v("1.分布式执行任务单一一致性问题需优化")]),e("p"),e("h2",{attrs:{id:"二、1-1改进设计"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、1-1改进设计","aria-hidden":"true"}},[t._v("#")]),t._v(" 二、1.1改进设计")]),e("h3",{attrs:{id:"_1-领域模型拆分"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-领域模型拆分","aria-hidden":"true"}},[t._v("#")]),t._v(" 1.领域模型拆分")]),e("img",{attrs:{src:"img1/d3-4.png"}}),e("h3",{attrs:{id:"_2-代码结构整理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-代码结构整理","aria-hidden":"true"}},[t._v("#")]),t._v(" 2.代码结构整理")]),e("p",[t._v("编写完成时优化，主要针对RetryAction进行拆分重构")]),e("h3",{attrs:{id:"_3-分布式执行任务单一一致性问题需优化"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-分布式执行任务单一一致性问题需优化","aria-hidden":"true"}},[t._v("#")]),t._v(" 3.分布式执行任务单一一致性问题需优化")]),e("p",[t._v("分片后根据ivr_call.id进行所得分片进行hash，原加锁逻辑不变防止一个call多次呼出。")]),e("h3",{attrs:{id:"_4-接口性能优化，响应时间从300ms压缩到100ms以内"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-接口性能优化，响应时间从300ms压缩到100ms以内","aria-hidden":"true"}},[t._v("#")]),t._v(" 4.接口性能优化，响应时间从300ms压缩到100ms以内")]),e("p",[t._v("针对长链条中的数据多次查询进行优化、缓存。")]),e("p",[t._v("费时较高的非必要操作异步化。")]),e("p",[t._v("优化数据结构，添加部分冗余字段，减少db请求")]),e("h3",{attrs:{id:"_5-风控报警设计"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5-风控报警设计","aria-hidden":"true"}},[t._v("#")]),t._v(" 5.风控报警设计")]),e("table",[e("thead",[e("tr",[e("th",[t._v("现象")]),e("th",{staticStyle:{"text-align":"center"}},[t._v("规则")]),e("th",{staticStyle:{"text-align":"right"}},[t._v("响应")])])]),e("tbody",[e("tr",[e("td",[t._v("无法触达")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("同一POI M天内超过N次未接听")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("告知订单此情况禁止部分下单 or 通过拒单隐藏逻辑")])]),e("tr",[e("td",[t._v("按键无反应")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("同一POI M天内超过N次接听超过S秒，但没有按键")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("切换外呼线路或切换服务商重新呼叫")])]),e("tr",[e("td",[t._v("多次拒单")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("同一POI M天内连续N次以上拒单")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("拒单隐藏逻辑 或 更重大惩罚措施（in order）?")])]),e("tr",[e("td",[t._v("服务商故障")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("同一Provider M分钟内连续调用API异常N次以上")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("降低该服务商权重为1(1%)，待确认恢复后，手工修改权重")])]),e("tr",[e("td",[t._v("系统故障")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("falcon监控")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("火线救援")])])])]),e("h3",{attrs:{id:"_6-提供部分运营可操作配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_6-提供部分运营可操作配置","aria-hidden":"true"}},[t._v("#")]),t._v(" 6.提供部分运营可操作配置")]),e("p",[e("strong",[t._v("设置商家电话线路")])]),e("p",[e("strong",[t._v("设置城市电话线路")])]),e("p",[e("strong",[t._v("配置TTS模板信息")])]),e("p",[e("strong",[t._v("配置服务商权重")])]),e("p"),e("h3",{attrs:{id:"_7-设计业务指标及精细化打点"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_7-设计业务指标及精细化打点","aria-hidden":"true"}},[t._v("#")]),t._v(" 7.设计业务指标及精细化打点")]),e("table",[e("thead",[e("tr",[e("th",[t._v("现象")]),e("th",{staticStyle:{"text-align":"center"}},[t._v("规则")]),e("th",{staticStyle:{"text-align":"right"}},[t._v("响应")])])]),e("tbody",[e("tr",[e("td",[t._v("CALL_OUT")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("执行呼叫")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("transaction")])]),e("tr",[e("td",[t._v("CALL_LOCKED")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("加锁准备开始呼叫")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("event")])]),e("tr",[e("td",[t._v("CALL_CREATE_TTS")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("生成模板动态信息")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("event")])]),e("tr",[e("td",[t._v("CALL_EXECUTE")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("第三方执行呼叫成功")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("event")])]),e("tr",[e("td",[t._v("CALL_NO_RESPONSE")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("呼叫未接听")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("metric")])]),e("tr",[e("td",[t._v("CALL_NO_PRESS")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("呼叫没有按键")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("metric")])]),e("tr",[e("td",[t._v("CALL_RESPONSE_SUCCESS")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("呼叫完成")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("metric")])]),e("tr",[e("td",[t._v("CALL_ORDER_ACCEPT")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("声讯接单")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("metric")])]),e("tr",[e("td",[t._v("CALL_ORDER_REFUSE")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("声讯拒单")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("metric")])]),e("tr",[e("td",[t._v("CALL_RECHECK_SUCCESS")]),e("td",{staticStyle:{"text-align":"center"}},[t._v("声讯复核成功")]),e("td",{staticStyle:{"text-align":"right"}},[t._v("metric")])])])]),e("p"),e("p",[t._v("8.天润回调接口优化")]),e("p",[t._v("select * from ivr_call where status = 10 limit 100;")]),e("p",[t._v("上线以来，共15条被锁住没有释放的call，其中一条可能为执行外呼时重启（时间较早，日志不好排查），14条因为没有收到回调，没收到回调的原因有：天润故障、cc机器重启")]),e("p",[t._v("处理方案为:")]),e("pre",[e("code",[t._v("与天润沟融，务必添加重试机制\n\n收到消息第一时间暂存，失败后重试\n\n处理因意外情况未收到回调的call(监控长时间上锁的call)\n\n修改重试策略为每5秒重试，重试10次")])])])}],!1,null,null,null);a.default=i.exports}}]);